<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="graphics/bot.png">
    <title>OWL | Classify Posts</title>
    <script src="js/querydecoder.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/nsapi.js"></script>
</head>
<body>
    <h1>Classify RMB Posts</h1>
    <pre id="loading">Loading data...</pre>
    <div id="lodged" hidden>
        <h2>Newly Lodged</h2>
    </div>
    <div id="edited" hidden>
        <h2>Newly Edited</h2>
    </div>
    <div>
        <hr>
        <p>
            <button id="classify" onclick="execute()">No Posts Marked Classified</button>
        </p>
    </div>
    <footer style="font-size: small; text-align: center;">
        <i>Created by <a href="https://github.com/anjo0803">anjo</a> / <a href="https://www.nationstates.net/tepertopia">Tepertopia</a></i>
    </footer>
    
    <script async src="js/classify.js"></script>
    <script>
        /*
        Wraps the currently signed vote classifications into a query string of the syntax:
        ?v=[version]&c=classify&[classified posts]

        [classified posts] is replaced with an array of signed classifications of the syntax:
        &[postid]=[stance]:[proposal]
        where [postid] is the ID of the RMB post containing the vote, [stance] is the code letter for the voter's stance (see classify.js), and [proposal] is the name of the proposal the vote is cast on.

        So, if post #12345 is a vote FOR the proposal "Testing" and post #54321 is a vote AGAINST the same, and these are the only posts being classified in version 1 of the web interface, the returned string will be:
        ?v=1&c=classify&12345=f:Testing&54321=a:Testing
        */
        function constructQueryString() {
            let str = '?v=' + BOTV + '&c=classify';
            for(let post of lodged) {
                let section = document.getElementById(post.id);
                if(section.getElementsByClassName('signoff')[0].checked) str += '&' + post.id + '=' + section.getElementsByClassName('stance')[0].value + ':' + section.getElementsByClassName('proposal')[0].value;
            }
            for(let post of edited) {
                let section = document.getElementById(post.id);
                if(section.getElementsByClassName('signoff')[0].checked) str += '&' + post.id + '=' + section.getElementsByClassName('stance')[0].value + ':' + section.getElementsByClassName('proposal')[0].value;
            }
            console.log(str);
            return str;
        }

        function execute() {
            location.href = 'execute.html' + constructQueryString();
        }
    </script>
</body>
</html>